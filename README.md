# LinDream - QQ机器人框架

## 🎉 LinDream V1.0.2 更新内容

### 新增功能
- **自动创建配置文件**：在启动时自动创建 `auto.txt` 和 `random.txt` 文件（如果不存在），包含默认的自动回复规则和戳一戳随机回复内容
- **补丁系统**：新增补丁系统，支持动态加载和应用补丁功能
- **消息输入状态事件**：新增对消息输入状态事件的处理和显示
- **群消息表情表态事件**：新增对群消息表情表态事件的处理和显示
- **群成员增加事件**：新增对群成员增加事件的处理和显示

### 功能优化
- **戳一戳功能增强**：优化戳一戳功能，支持更丰富的随机回复内容
- **AI聊天优化**：改进AI聊天功能，优化@机器人时的对话体验
- **私聊AI聊天**：在私聊中直接输入内容即可触发AI聊天
- **人格切换优化**：切换人格时自动清除对话历史，避免人格混淆
- **会话历史管理**：新增清除会话历史功能 `/clear` 指令
- **日志显示优化**：改进各类日志信息的显示格式，增加样式美化
- **权限系统增强**：完善权限管理机制，支持多级权限控制

### 问题修复
- **消息处理修复**：修复了消息处理过程中的一些潜在问题
- **配置加载修复**：优化配置文件加载逻辑，提高稳定性
- **插件处理修复**：修复了插件消息处理中的一些问题

### 架构改进
- **代码结构优化**：重构部分代码结构，提高可维护性
- **事件处理优化**：改进事件处理逻辑，增强系统稳定性
- **依赖管理优化**：优化依赖管理机制，提升加载效率

---

## 🎉 LinDream V1.0.1 更新内容

### 新增功能
- **插件依赖自动管理**：新增插件依赖检查与安装功能，启动时自动检查并安装插件所需的依赖包
- **插件requirements.txt管理**：为所有插件生成并维护requirements.txt文件，便于依赖管理

### 功能优化
- **事件日志增强**：改进了各类事件的显示格式，现在会显示群名称和用户名，而非仅显示ID
- **消息事件支持**：新增对message_sent事件的处理，可正确显示机器人发送的消息
- **头衔变更事件**：新增对群头衔变更事件的处理和显示
- **跨容器文件处理**：优化文件处理机制，修复了Termux与proot容器间文件路径不互通的问题

### 问题修复
- **图片发送修复**：修复了因文件路径问题导致的图片发送失败
- **事件处理完善**：解决了未知事件显示问题，现在能正确处理各种新事件类型

### 架构改进
- **代码结构优化**：改进了事件处理逻辑，提高代码可读性和维护性
- **插件系统增强**：插件系统现在更加健壮，支持自动依赖管理

---

## 📋 项目介绍

LinDream是一个基于Python开发的QQ机器人框架，采用WebSocket协议与OneBot协议兼容的QQ机器人平台（如go-cqhttp）进行通信。项目具有插件化架构，支持自动回复、AI聊天、媒体文件下载、权限管理等功能。

## ✨ 核心功能

### 🤖 基础功能
- **消息收发**：支持群聊和私聊消息处理
- **自动回复**：关键词触发自动回复功能
- **随机回复**：被@时随机选择回复内容
- **媒体文件下载**：自动下载群聊中的图片和视频文件
- **消息防撤回**：记录消息内容，防止撤回
- **会话管理**：用户和群聊的独立会话历史

### 🧠 AI聊天功能
- **智能对话**：集成主流AI API（支持自定义API地址和模型）
- **人格切换**：支持多种AI人格配置
- **上下文记忆**：保持对话历史，提供连贯的对话体验
- **触发方式**：支持`%`前缀或直接@机器人触发

### 🔧 插件系统
- **动态加载**：支持运行时加载和卸载插件
- **插件管理**：通过指令查看和管理插件
- **自定义触发**：插件可定义自己的触发指令
- **事件处理**：插件可处理各类消息事件

### 👥 权限管理
- **多级权限**：主人(3)、管理员(2)、用户(1)三级权限
- **动态授权**：支持运行时添加/移除管理员
- **指令权限**：不同权限等级可执行不同指令

### ⚙️ 配置管理
- **配置文件**：JSON格式配置，支持API密钥、权限设置等
- **热重载**：支持运行时重载配置和插件
- **人格文件**：TXT格式人格定义，可自定义AI行为

## 🚀 部署教程

### 环境要求
- Python 3.8+
- OneBot协议兼容的QQ机器人平台

### 1. 克隆项目(默认使用镜像加速)
```bash
git clone http://github.fufumc.top/https://github.com/DXBbyd/LinDream.git
cd LinDream
```

### 2. 安装uv包管理器,创建虚拟环境，并进入
```bash
uv venv
source .venv/bin/activate
```

### 3. 安装依赖
```bash
uv pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple
```
### 4.配置消息平台（NaoCat）
详细安装方式请参见→napcat.wiki
在WebUI中设置ws反向代理连接地址为ws://127.0.01:2048，不配置token。即可

### 5. 配置机器人
应该是不需要手动创建的，因为首次启动会询问你的哦~
创建 `config.json` 文件：
```json
{
    "api_key": "your_ai_api_key",
    "api_url": "https://apis.iflow.cn/v1/chat/completions",
    "model_name": "qwen3-coder-plus",
    "owner_id": "你的QQ号",
    "admins": ["管理员QQ号1", "管理员QQ号2"],
    "users": ["用户QQ号1", "用户QQ号2"]
}
```

### 6. 配置自动回复
下面是自动回复格式，一行一个配置
```
关键词1 回复内容1
关键词2 回复内容2
```

### 7. 配置随机回复
这个是戳一戳的随机回复
```
随机回复内容1
随机回复内容2
随机回复内容3
```

### 8. 配置人格（可选）
在 `persona/` 目录下创建人格文件，如 `default.txt`：
```
你是一个友好的AI助手，乐于助人且回答简洁明了。
```

### 9. 启动机器人
```bash
python main.py
```

## 📖 使用说明

### 基础指令
- `/help` - 显示帮助信息
- `/limit` - 查看当前权限等级
- `/plugin` - 显示已加载的插件列表
- `/persona ls` - 列出所有人格
- `/persona <名称>` - 切换人格
- `/reset` - 重载配置和插件（管理员以上权限）

### AI聊天
- 在群聊中@机器人并输入消息
- 或使用 `%` 前缀：`%你好，请自我介绍`

### 插件使用
- 查看插件列表：`/plugin`
- 插件具体使用方法请查看各插件说明

## 📁 项目结构
```
LinDream/
├── main.py              # 主程序
├── requirements.txt     # 依赖列表
├── config.json         # 配置文件（需自建）
├── auto.txt            # 自动回复规则（需自建）
├── random.txt          # 随机回复内容（需自建）
├── message_log.txt     # 消息日志（自动生成）
├── persona/            # 人格配置目录
│   └── default.txt     # 默认人格
├── plugin/             # 插件目录
│
└── file/               # 下载文件存储
    ├── picture/        # 图片文件
    └── video/          # 视频文件（仅缓存10分钟）
```

## 🔧 高级配置

### API配置
支持自定义AI服务提供商，配置格式：
```json
{
    "api_key": "your_api_key",
    "api_url": "https://your-api-endpoint.com/v1/chat/completions",
    "model_name": "your-model-name"
}
```

### 权限系统
- **主人权限**：可以执行所有指令，管理管理员
- **管理员权限**：可以重载配置，协助管理
- **用户权限**：可以使用基础功能和AI聊天

### 插件开发
插件需要实现以下函数之一：
- `on_message(websocket, data, bot_id)` - 处理消息
- `on_command(websocket, data, command, bot_id)` - 处理指令
- `on_load()` - 插件加载时调用

## 📝 注意事项

1. **安全性**：请妥善保管API密钥和配置文件
2. **性能**：建议设置适当的下载线程数和消息缓存大小
3. **合规性**：使用机器人时请遵守相关平台规定
4. **稳定性**：建议定期清理下载的文件和日志

## 🤝 贡献

欢迎提交Issue和Pull Request来改进项目！

## 📄 许可证

本项目采用MIT许可证 - 详见LICENSE文件
## 结语
欢迎去B站找我反馈bug，或者去我的视频下面提插件的建议，合理的话我一定会写的！！！
UP的B站，直接搜名字就能搜到哦，一定要点用户哦！UP的名字:软白from
你的三连就是我坚持的动力喵！
